<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .fade-in {
            animation: .3s forwards fadeIn;
        }

        .fade-out {
            animation: .3s forwards fadeOut;
        }
    </style>
</head>
<body>
<ul>
    <li data-wrapper="">
        <span data-trigger="" tabindex="0">Primo</span>
        <ul data-drop="">
            <li data-wrapper="">
                <span data-trigger="">#1 - Primo</span>
                <ul data-drop="">
                    <li><span>#2 - Primo</span></li>
                    <li><span>#2 - Secondo</span></li>
                    <li><span>#2 - Terzo</span></li>
                </ul>
            </li>
            <li><span>#1 - Secondo</span></li>
            <li><span>#1 - Terzo</span></li>
        </ul>
    </li>
    <li data-wrapper="">
        <span data-trigger="">Secondo</span>
        <ul data-drop="">
            <li><span>#1 - Primo</span></li>
            <li><span>#1 - Secondo</span></li>
            <li><span>#1 - Terzo</span></li>
        </ul>
    </li>
    <li><span>Terzo</span></li>
</ul>

<script>
    const options = {
        wrapper: '[data-wrapper]',
        trigger: '[data-trigger]',
        drop: '[data-drop]',
        animationIn: 'fade-in',
        animationOut: 'fade-out',
        display: 'block'
    };

    const nodes = document.querySelectorAll(options.wrapper);

    nodes.forEach((node) => {
        const trigger = node.querySelector(options.trigger);

        trigger.setAttribute('tabindex', '0');

        const submenu = node.querySelector(options.drop);

        const show = () => {
            if (options.animationIn) {
                submenu.addEventListener('animationend', () => {
                    submenu.classList.remove(options.animationIn);
                }, { once: true });

                submenu.classList.add(options.animationIn);
            }

            submenu.style.display = options.display;
        };

        const hide = () => {
            submenu.addEventListener('animationend', () => {
                submenu.style.display = 'none';

                if (options.animationOut) {
                    submenu.classList.remove(options.animationOut);
                }
            }, { once: true });

            options.animationOut
                ? submenu.classList.add(options.animationOut)
                : submenu.dispatchEvent(new Event('animationend'));
        };

        const toggle = () => {
            submenu.checkVisibility() ? hide() : show();
        }

        trigger.addEventListener('click', () => toggle());

        trigger.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') toggle();
        });
    });
</script>
</body>
</html>