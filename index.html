<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .fade-in {
            animation: .3s forwards fadeIn;
        }

        .fade-out {
            animation: .3s forwards fadeOut;
        }

        [data-drop] {
            display: none;
        }
    </style>
</head>
<body>
<ul data-droppy="">
    <li data-wrapper="">
        <span data-trigger="" tabindex="0">Primo</span>
        <ul data-drop="">
            <li data-wrapper="">
                <span data-trigger="">#1 - Primo</span>
                <ul data-drop="">
                    <li><span>#2 - Primo</span></li>
                    <li><span>#2 - Secondo</span></li>
                    <li><span>#2 - Terzo</span></li>
                </ul>
            </li>
            <li><span>#1 - Secondo</span></li>
            <li><span>#1 - Terzo</span></li>
        </ul>
    </li>
    <li data-wrapper="">
        <span data-trigger="">Secondo</span>
        <ul data-drop="">
            <li><span>#1 - Primo</span></li>
            <li><span>#1 - Secondo</span></li>
            <li><span>#1 - Terzo</span></li>
        </ul>
    </li>
    <li><span>Terzo</span></li>
</ul>

<script>
    'use strict';

    /**
     * @typedef {Object} DroppyOptions
     * @prop {string} animationIn
     * @prop {string} animationOut
     * @prop {string} display
     */

    /** @type DroppyOptions */
    const defaultOptions = {
        animationIn: '',
        animationOut: '',
        display: 'block'
    }

    class Droppy {
        /** @type {HTMLElement} */
        trigger;
        /** @type {HTMLElement} */
        drop;
        /** @type {DroppyOptions} */
        options;

        /**
         * @param {HTMLElement} trigger
         * @param {HTMLElement} drop
         * @param {DroppyOptions} options
         */
        constructor(trigger, drop, options) {
            this.trigger = trigger;

            this.trigger.addEventListener('click', () => this.toggle());

            this.drop = drop;

            this.options = { ...defaultOptions, ...options };
        }

        show() {
            if (this.options.animationIn) {
                this.drop.addEventListener('animationend', () => {
                    this.drop.classList.remove(this.options.animationIn);
                }, { once: true });

                this.drop.classList.add(this.options.animationIn);
            }

            this.drop.style.display = this.options.display;
        };

        hide() {
            this.drop.addEventListener('animationend', () => {
                this.drop.style.display = 'none';

                if (this.options.animationOut) {
                    this.drop.classList.remove(this.options.animationOut);
                }
            }, { once: true });

            this.options.animationOut
                ? this.drop.classList.add(this.options.animationOut)
                : this.drop.dispatchEvent(new Event('animationend'));
        };

        toggle() {
            this.drop.checkVisibility() ? this.hide() : this.show();
        }
    }

    const generator = (root, options) => {
        const nodes = root.querySelectorAll(options.wrapper);

        nodes.forEach(node => {
            const trigger = node.querySelector(options.trigger);
            const drop = node.querySelector(options.drop);

            new Droppy(trigger, drop, options);
        })
    }

    const roots = document.querySelectorAll('[data-droppy]');

    const options = {
        wrapper: '[data-wrapper]',
        trigger: '[data-trigger]',
        drop: '[data-drop]',
        animationIn: 'fade-in',
        animationOut: 'fade-out',
        display: 'block'
    };

    roots.forEach(root => generator(root, options));
</script>
</body>
</html>